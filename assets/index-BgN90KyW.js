(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();function m(){const s=performance.now();let t=s;return{get total(){return performance.now()-s},get interval(){return performance.now()-t},delta(){const e=performance.now(),i=e-t;return t=e,i}}}const w={VIEWPORT_WIDTH:1280,VIEWPORT_HEIGHT:720,VSYNC:!1,FPS:60,HIDE_CURSOR:!1,IMAGE_SMOOTHING:!1};function _(s){const t=s.getContext("2d");if(t===null)throw new Error("Cannot get 2D context from canvas.");return t}class T{options;canvas;ctx;run;fps;currentFrame;drawFrame;constructor(t,e={}){this.options={...w,...e},this.canvas=t,this.ctx=_(this.canvas),this.run=!0,this.fps=0,this.currentFrame=-1,this.setup()}setup(){this.canvas.width=this.options.VIEWPORT_WIDTH,this.canvas.height=this.options.VIEWPORT_HEIGHT,this.options.HIDE_CURSOR&&(this.canvas.style.cursor="none"),window.ENGINE=this}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(t){const e=m();this.fps=0,this.currentFrame=0,this.drawFrame=()=>{this.ctx.imageSmoothingEnabled=this.options.IMAGE_SMOOTHING,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t({fps:this.fps.toFixed(2),currentFrame:this.currentFrame}),this.currentFrame++};const i=()=>{this.drawFrame&&this.run&&this.drawFrame(),e.interval>1e3&&(this.fps=this.currentFrame/e.delta()*1e3,this.currentFrame=0),this.options.VSYNC?requestAnimationFrame(i):setTimeout(i,1e3/this.options.FPS)};return i()}}function v(s){for(const[t,e]of s)if(t)return typeof e=="function"?e():e}class x{engine;position;size;color;constructor(t){this.engine=t,this.size={width:0,height:0},this.position={x:0,y:0},this.color="transparent",console.log("Entity initialized.")}setSize(t,e){return this.size={width:t,height:e??t},this}setPosition(t){return typeof t=="function"&&(t=t(this.position)),this.position={x:Math.floor(t.x),y:Math.floor(t.y)},this}setColor(t){return this.color=t,this}getProjections(t){const{x:e,y:i}=t||this.position,{width:n,height:o}=this.size;return{x1:e,x2:e+n,y1:i,y2:i+o}}draw(){const t=this.engine.ctx;t.fillStyle=this.color,t.fillRect(this.position.x,this.position.y,this.size.width,this.size.height)}willCollide(t,e){const i=this.getProjections(t),n=e.getProjections();return i.x1<n.x2&&i.x2>n.x1&&i.y2>n.y1&&i.y1<n.y2}isColliding(t){return this.willCollide(this.position,t)}relativePosition(t){const e=this.getProjections(),i=t.getProjections();return v([[e.y1>=i.y2,"TOP"],[e.x2<=i.x1,"RIGHT"],[e.y2<=i.y1,"BOTTOM"],[e.x1>=i.x2,"LEFT"]])||!1}isInBound(t){return t.x>=this.position.x&&t.x<this.position.x+this.size.width&&t.y>=this.position.y&&t.y<this.position.y+this.size.height}}class I extends x{fps;currentFrame;constructor(t){super(t)}update(t,e){this.fps=t,this.currentFrame=e}draw(){const t=this.engine.ctx,{x:e,y:i}=this.position;t.fillStyle="black",t.fillRect(e,i,135,24),t.fillRect(e,i+25,122,24),t.fillStyle="yellow",t.font="24px Consolas, monospace, sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(`FPS: ${this.fps}`,e,i),t.fillText(`Frame: ${this.currentFrame}`,e,i+25)}}function h(s,t){return s=Math.ceil(s),t=Math.floor(t),Math.floor(Math.random()*(t-s+1))+s}function u(s,t){return Math.random()<.5?s:t}class P extends x{name;speed_y;speed_x;colliders;constructor(t){super(t);const e=h(1,5);this.speed_y=e*u(-1,1),this.speed_x=e*u(-1,1),this.size={width:h(50,200),height:h(50,200)},this.position={x:h(10,window.innerWidth-this.size.width-10),y:h(10,window.innerHeight-this.size.height-10)},this.name="box",this.colliders=[],this.setColor("lime")}setName(t){return this.name=t,this}setColliders(t){return this.colliders=t,this}getNextPosition(){return{x:this.position.x+this.speed_x,y:this.position.y+this.speed_y}}onCollision(t){console.log(`${this.name} got hit by ${t.name}`,t)}draw(){this.setPosition(()=>{const t=this.getNextPosition();for(const r of this.colliders)if(this.willCollide(t,r)){const g=this.relativePosition(r),c=r.getProjections();switch(g){case"TOP":this.speed_y*=-1,t.y=c.y2;break;case"BOTTOM":this.speed_y*=-1,t.y=c.y1-this.size.height;break;case"RIGHT":this.speed_x*=-1,t.x=c.x1-this.size.width;break;case"LEFT":this.speed_x*=-1,t.x=c.x2;break}r.onCollision(this)}const e=this.getProjections(t),i=Math.abs(this.speed_x),n=Math.abs(this.speed_y),{canvas:o}=this.engine;return e.x1<=0&&e.x2<o.width?(this.speed_x=i,t.x=0):e.x1>0&&e.x2>o.width&&(this.speed_x=-1*i,t.x=o.width-this.size.width),e.y1<=0&&e.y2<o.height?(this.speed_y=n,t.y=0):e.y1>0&&e.y2>o.height&&(this.speed_y=-1*n,t.y=o.height-this.size.height),t}),super.draw(),this.engine.ctx.fillStyle="black",this.engine.ctx.font="24px Consolas, monospace, sans-serif",this.engine.ctx.textAlign="left",this.engine.ctx.textBaseline="top",this.engine.ctx.fillText(this.name,this.position.x,this.position.y)}}function E(s){return new Promise(t=>{const e=new Image;e.onload=()=>{t(e)},e.onerror=()=>{throw new Error(`Image error: ${s}`)},e.src=s})}function C(s=window){const t={x:0,y:0,active:!1};return s.addEventListener("mousemove",e=>{if(e instanceof MouseEvent){const{clientX:i,clientY:n}=e;t.x=i,t.y=n,t.active=!0}}),s.addEventListener("mouseleave",()=>{t.active=!1}),t}const y=document.getElementById("mainframe"),d=C(y),a=new T(y,{VIEWPORT_WIDTH:window.innerWidth,VIEWPORT_HEIGHT:window.innerHeight,VSYNC:!0,HIDE_CURSOR:!0}),f=await E("./diamond_sword.png"),p=new I(a),l=[],F=5;for(let s=0;s<F;s++){const t=new P(a).setName(`${s}`);l.push(t)}for(const s of l)s.setColliders(l.filter(t=>t!==s));a.render(s=>{for(const i of l)i.draw();const{fps:t,currentFrame:e}=s;p.update(t,e),p.draw(),d.active&&a.ctx.drawImage(f,d.x,d.y,f.width*4,f.height*4)});
