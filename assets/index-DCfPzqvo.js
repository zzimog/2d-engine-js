(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function O(){const s=performance.now();let e=s;return{get total(){return performance.now()-s},get interval(){return performance.now()-e},delta(){const t=performance.now(),i=t-e;return e=t,i}}}const _={VIEWPORT_WIDTH:1280,VIEWPORT_HEIGHT:720,VSYNC:!1,FPS:60,HIDE_CURSOR:!1,IMAGE_SMOOTHING:!1};function E(s){const e=s.getContext("2d");if(e===null)throw new Error("Cannot get 2D context from canvas.");return e}class b{options;canvas;ctx;run;fps;currentFrame;drawFrame;constructor(e,t={}){this.options={..._,...t},this.canvas=e,this.ctx=E(this.canvas),this.run=!0,this.fps=0,this.currentFrame=-1,this.setup()}setup(){this.canvas.width=this.options.VIEWPORT_WIDTH,this.canvas.height=this.options.VIEWPORT_HEIGHT,this.options.HIDE_CURSOR&&(this.canvas.style.cursor="none"),window.ENGINE=this}resize(e,t){this.canvas.width=e,this.canvas.height=t}render(e){const t=O();this.fps=0,this.currentFrame=0,this.drawFrame=()=>{this.ctx.imageSmoothingEnabled=this.options.IMAGE_SMOOTHING,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e({fps:this.fps.toFixed(2),currentFrame:this.currentFrame}),this.currentFrame++};const i=()=>{this.drawFrame&&this.run&&this.drawFrame(),t.interval>1e3&&(this.fps=this.currentFrame/t.delta()*1e3,this.currentFrame=0),this.options.VSYNC?requestAnimationFrame(i):setTimeout(i,1e3/this.options.FPS)};return i()}}function T(s){for(const[e,t]of s)if(e)return typeof t=="function"?t():t}const o=Object.freeze({UP:"up",TOP:"top",RIGHT:"right",BOTTOM:"bottom",DOWN:"down",LEFT:"left"});function I(s){return T([[s==o.TOP,o.BOTTOM],[s==o.UP,o.DOWN],[s==o.BOTTOM,o.TOP],[s==o.DOWN,o.UP],[s==o.RIGHT,o.LEFT],[s==o.LEFT,o.RIGHT]])}class w{engine;position;size;color;constructor(e){this.engine=e,this.size={width:0,height:0},this.position={x:0,y:0},console.log("Entity initialized.")}setSize(e){return typeof e=="number"?e={width:e,height:e}:typeof e=="function"&&(e=e({...this.size})),this.size={...e},this}setPosition(e){return typeof e=="function"&&(e=e({...this.position})),this.position={x:Math.floor(e.x),y:Math.floor(e.y)},this}setColor(e){return typeof e=="function"&&(e=e(this.color)),this.color=e,this}getProjections(e){const{x:t,y:i}=e||this.position,{width:n,height:r}=this.size;return{x1:t,x2:t+n,y1:i,y2:i+r}}draw(){const e=this.engine.ctx;this.color&&(e.fillStyle=this.color),e.fillRect(this.position.x,this.position.y,this.size.width,this.size.height)}willCollide(e,t){const i=this.getProjections(e),n=t.getProjections();return i.x1<n.x2&&i.x2>n.x1&&i.y2>n.y1&&i.y1<n.y2}isColliding(e){return this.willCollide(this.position,e)}relativePosition(e){const t=this.getProjections(),i=e.getProjections();return T([[t.y1>=i.y2,o.TOP],[t.x2<=i.x1,o.RIGHT],[t.y2<=i.y1,o.BOTTOM],[t.x1>=i.x2,o.LEFT]])||!1}contains(e){return e.x>=this.position.x&&e.x<this.position.x+this.size.width&&e.y>=this.position.y&&e.y<this.position.y+this.size.height}}class v extends w{fps;currentFrame;constructor(e){super(e)}update(e,t){this.fps=e,this.currentFrame=t}draw(){const e=this.engine.ctx,{x:t,y:i}=this.position;e.fillStyle="black",e.fillRect(t,i,135,24),e.fillRect(t,i+25,122,24),e.fillStyle="yellow",e.font="24px Consolas, monospace, sans-serif",e.textAlign="left",e.textBaseline="top",e.fillText(`FPS: ${this.fps}`,t,i),e.fillText(`Frame: ${this.currentFrame}`,t,i+25)}}function F(s,e){return Math.max(s,e)}function C(s,e){return Math.min(s,e)}function M(s,e,t){return F(C(s,t),e)}function d(s,e){return s=Math.ceil(s),e=Math.floor(e),Math.floor(Math.random()*(e-s+1))+s}function g(s,e){return Math.random()<.5?s:e}class S extends w{name;speed_y;speed_x;colliders;constructor(e){super(e),this.color="lime",this.name="box",this.colliders=[],this.size={width:d(50,200),height:d(50,200)};const t=d(1,5);this.speed_y=t*g(-1,1),this.speed_x=t*g(-1,1);const{canvas:i}=this.engine;this.position={x:d(10,i.width-this.size.width-10),y:d(10,i.height-this.size.height-10)}}setName(e){return this.name=e,this}setColliders(e){return this.colliders=e,this}onCollision(e,t){switch(e){case o.TOP:case o.BOTTOM:{this.speed_y=-1*t.speed_y;break}case o.LEFT:case o.RIGHT:{this.speed_x=-1*t.speed_x;break}}}update(){const e={x:this.position.x+this.speed_x,y:this.position.y+this.speed_y};for(const c of this.colliders)if(this.willCollide(e,c)){const a=this.relativePosition(c),f=c.getProjections();if(a===!1)continue;switch(a){case o.TOP:{this.speed_y=c.speed_y,e.y=f.y2;break}case o.BOTTOM:{this.speed_y=c.speed_y,e.y=f.y1-this.size.height;break}case o.RIGHT:{this.speed_x=c.speed_x,e.x=f.x1-this.size.width;break}case o.LEFT:{this.speed_x=c.speed_x,e.x=f.x2;break}}c.onCollision(I(a),this)}const t=this.getProjections(e),i=Math.abs(this.speed_x),n=Math.abs(this.speed_y),{canvas:r}=this.engine;t.x1<0&&t.x2<r.width?(this.speed_x=i,e.x=0):t.x1>0&&t.x2>r.width&&(this.speed_x=-1*i,e.x=r.width-this.size.width),t.y1<0&&t.y2<r.height?(this.speed_y=n,e.y=0):t.y1>0&&t.y2>r.height&&(this.speed_y=-1*n,e.y=r.height-this.size.height),this.setPosition(e)}draw(){this.update(),super.draw(),this.engine.ctx.fillStyle="black",this.engine.ctx.font="24px Consolas, monospace, sans-serif",this.engine.ctx.textAlign="left",this.engine.ctx.textBaseline="top",this.engine.ctx.fillText(this.name,this.position.x,this.position.y)}}function H(s){return new Promise(e=>{const t=new Image;t.onload=()=>{e(t)},t.onerror=()=>{throw new Error(`Image error: ${s}`)},t.src=s})}function R(s=window){const e={x:0,y:0,active:!1};return s.addEventListener("mousemove",t=>{if(t instanceof MouseEvent){const{clientX:i,clientY:n}=t;e.x=i,e.y=n,e.active=!0}}),s.addEventListener("mouseleave",()=>{e.active=!1}),e}function p(s){return s?1:0}function k(){const s=new Map,e=new Set;window.addEventListener("keydown",t=>{t.repeat||(s.set(t.code,!0),e.delete(t.code))}),window.addEventListener("keyup",t=>{s.delete(t.code),e.add(t.code)});for(const t of["blur","contextmenu"])window.addEventListener(t,()=>s.clear());return{keyPressed(t){return p(s.has(t))},keyDown(t){const i=s.get(t);return i&&s.set(t,!1),p(i)},keyUp(t){const i=e.has(t);return i&&e.delete(t),p(i)},clear(){s.clear(),e.clear()}}}const P=document.getElementById("mainframe"),y=R(P),l=k(),h=new b(P,{VIEWPORT_WIDTH:window.innerWidth,VIEWPORT_HEIGHT:window.innerHeight,VSYNC:!0,HIDE_CURSOR:!0}),x=await H("./diamond_sword.png"),m=new v(h),L=new w(h).setColor("blue").setSize(200).setPosition({x:h.canvas.width/2-100,y:h.canvas.height/2-100}),u=[],N=Number(prompt("boxes count? (between 5 and 20)","10")),D=M(N,5,20);for(let s=0;s<D;s++){const e=i=>{for(const n of u)if(i.isColliding(n))return!0;return!1};let t=null;do t=new S(h).setName(`${s}`);while(e(t));u.push(t)}for(const s of u)s.setColliders(u.filter(e=>e!==s));h.render(s=>{for(const a of u)a.draw();l.keyDown("KeyP")&&console.log("key P down"),l.keyUp("KeyL")&&console.log("key L released");const e=5,t=l.keyPressed("KeyD")-l.keyPressed("KeyA"),i=l.keyPressed("KeyS")-l.keyPressed("KeyW"),n=t!=0&&i!=0?Math.sqrt(2):1;L.setColor(t!=0||i!=0?"red":"blue").setPosition(a=>({x:a.x+t*e/n,y:a.y+i*e/n})).draw();const{fps:r,currentFrame:c}=s;m.update(r,c),m.draw(),y.active&&h.ctx.drawImage(x,y.x,y.y,x.width*4,x.height*4)});
