(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();function x(){const i=performance.now();let t=i;return{get total(){return performance.now()-i},get interval(){return performance.now()-t},delta(){const e=performance.now(),s=e-t;return t=e,s}}}const g={VIEWPORT_WIDTH:1280,VIEWPORT_HEIGHT:720,VSYNC:!1,FPS:60,HIDE_CURSOR:!1,IMAGE_SMOOTHING:!1};function m(i){const t=i.getContext("2d");if(t===null)throw new Error("Cannot get 2D context from canvas.");return t}class y{options;canvas;ctx;run;fps;currentFrame;drawFrame;constructor(t,e={}){this.options={...g,...e},this.canvas=t,this.ctx=m(this.canvas),this.run=!0,this.fps=0,this.currentFrame=-1,this.setup()}setup(){this.canvas.width=this.options.VIEWPORT_WIDTH,this.canvas.height=this.options.VIEWPORT_HEIGHT,this.options.HIDE_CURSOR&&(this.canvas.style.cursor="none"),window.ENGINE=this}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(t){const e=x();this.fps=0,this.currentFrame=0,this.drawFrame=()=>{this.ctx.imageSmoothingEnabled=this.options.IMAGE_SMOOTHING,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t({fps:this.fps.toFixed(2),currentFrame:this.currentFrame}),this.currentFrame++};const s=()=>{this.drawFrame&&this.run&&this.drawFrame(),e.interval>1e3&&(this.fps=this.currentFrame/e.delta()*1e3,this.currentFrame=0),this.options.VSYNC?requestAnimationFrame(s):setTimeout(s,1e3/this.options.FPS)};return s()}}function w(i){for(const[t,e]of i)if(t)return typeof e=="function"?e():e}class u{engine;position;size;color;constructor(t){this.engine=t,this.size={width:0,height:0},this.position={x:0,y:0},this.color="transparent",console.log("Entity initialized.")}setSize(t,e){return this.size={width:t,height:e??t},this}setPosition(t){return typeof t=="function"&&(t=t(this.position)),this.position={x:Math.floor(t.x),y:Math.floor(t.y)},this}setColor(t){return this.color=t,this}getProjections(t){const{x:e,y:s}=t||this.position,{width:o,height:n}=this.size;return{x1:e,x2:e+o,y1:s,y2:s+n}}draw(){const t=this.engine.ctx;t.fillStyle=this.color,t.fillRect(this.position.x,this.position.y,this.size.width,this.size.height)}willCollide(t,e){const s=this.getProjections(t),o=e.getProjections();return s.x1<o.x2&&s.x2>o.x1&&s.y2>o.y1&&s.y1<o.y2}isColliding(t){return this.willCollide(this.position,t)}relativePosition(t){const e=this.getProjections(),s=t.getProjections();return w([[e.y1>=s.y2,"TOP"],[e.x2<=s.x1,"RIGHT"],[e.y2<=s.y1,"BOTTOM"],[e.x1>=s.x2,"LEFT"]])||!1}isInBound(t){return t.x>=this.position.x&&t.x<this.position.x+this.size.width&&t.y>=this.position.y&&t.y<this.position.y+this.size.height}}class _ extends u{fps;currentFrame;constructor(t){super(t)}update(t,e){this.fps=t,this.currentFrame=e}draw(){const t=this.engine.ctx,{x:e,y:s}=this.position;t.fillStyle="black",t.fillRect(e,s,135,24),t.fillRect(e,s+25,122,24),t.fillStyle="yellow",t.font="24px Consolas, monospace, sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(`FPS: ${this.fps}`,e,s),t.fillText(`Frame: ${this.currentFrame}`,e,s+25)}}function h(i,t){return i=Math.ceil(i),t=Math.floor(t),Math.floor(Math.random()*(t-i+1))+i}class T extends u{name;speed_y;speed_x;colliders;constructor(t){super(t);const e=h(1,5);this.speed_y=e,this.speed_x=e,this.size={width:h(50,200),height:h(50,200)},this.position={x:h(10,window.innerWidth-this.size.width-10),y:h(10,window.innerHeight-this.size.height-10)},this.name="box",this.colliders=[],this.setColor("lime")}setName(t){return this.name=t,this}setColliders(t){return this.colliders=t,this}getNextPosition(){return{x:this.position.x+this.speed_x,y:this.position.y+this.speed_y}}onCollision(t){console.log(`${this.name} got hit by ${t.name}`,t)}draw(){this.setPosition(()=>{const t=this.getNextPosition();for(const r of this.colliders)if(this.willCollide(t,r)){switch(this.relativePosition(r)){case"TOP":case"BOTTOM":this.speed_y*=-1,r.speed_y=-1*this.speed_y;break;case"RIGHT":case"LEFT":this.speed_x*=-1,r.speed_x=-1*this.speed_x;break}r.onCollision(this)}const e=this.getProjections(this.getNextPosition()),s=Math.abs(this.speed_x),o=Math.abs(this.speed_y),{canvas:n}=this.engine;return e.x1<=0&&e.x2<n.width?(this.speed_x=s,this.position.x=0):e.x1>0&&e.x2>n.width&&(this.speed_x=-1*s,this.position.x=n.width-this.size.width),e.y1<=0&&e.y2<n.height?(this.speed_y=o,this.position.y=0):e.y1>0&&e.y2>n.height&&(this.speed_y=-1*o,this.position.y=n.height-this.size.height),this.getNextPosition()}),super.draw(),this.engine.ctx.fillStyle="black",this.engine.ctx.font="24px Consolas, monospace, sans-serif",this.engine.ctx.textAlign="left",this.engine.ctx.textBaseline="top",this.engine.ctx.fillText(this.name,this.position.x,this.position.y)}}function v(i){return new Promise(t=>{const e=new Image;e.onload=()=>{t(e)},e.onerror=()=>{throw new Error(`Image error: ${i}`)},e.src=i})}function I(i=window){const t={x:0,y:0,active:!1};return i.addEventListener("mousemove",e=>{if(e instanceof MouseEvent){const{clientX:s,clientY:o}=e;t.x=s,t.y=o,t.active=!0}}),i.addEventListener("mouseleave",()=>{t.active=!1}),t}const p=document.getElementById("mainframe"),l=I(p),c=new y(p,{VIEWPORT_WIDTH:window.innerWidth,VIEWPORT_HEIGHT:window.innerHeight,VSYNC:!0,HIDE_CURSOR:!0}),d=await v("./diamond_sword.png"),f=new _(c),a=[],P=5;for(let i=0;i<P;i++){const t=new T(c).setName(`${i}`);a.push(t)}for(const i of a)i.setColliders(a.filter(t=>t!==i));c.render(i=>{for(const s of a)s.draw();const{fps:t,currentFrame:e}=i;f.update(t,e),f.draw(),l.active&&c.ctx.drawImage(d,l.x,l.y,d.width*4,d.height*4)});
